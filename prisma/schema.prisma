generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Tattoo {
  id          String   @id @default(cuid())
  title       String?
  imageUrl    String
  style       String?
  description String?
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model StandupGig {
  id           String   @id @default(uuid())
  title        String
  placeDetails String?
  address      String
  date         DateTime
  isPublic     Boolean  @default(true)
  time         String?
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  USER
  ADMIN
}

//Tilit
model Account {
  id Int @id @default(autoincrement())

  number Int    @default(0)
  name   String @unique
  type   String @default("tulo")

  instruction    String?
  vatHandling    String  @default("Kotimaan verollinen myynti")
  vatRate        Float   @default(0)
  openingBalance Float   @default(0)

  createdAt DateTime @default(now())
}

//Kirjanpito
model BookkeepingEntry {
  id            Int      @id @default(autoincrement())
  date          DateTime
  description   String?
  type          String // tulo / meno
  amount        Float
  vatRate       Float
  vatAmount     Float
  paymentMethod String?
  receiptNumber String?
  createdAt     DateTime @default(now())

  // ‚≠ê UUSI SUHDE KATEGORIAAN
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  receipt Receipt?
}

model Receipt {
  id         Int      @id @default(autoincrement())
  fileUrl    String // Polku tiedostoon, esim. "/receipts/2025-11-03_tosite_001.pdf"
  uploadedAt DateTime @default(now())

  entryId Int              @unique
  entry   BookkeepingEntry @relation(fields: [entryId], references: [id])
}

//Tuotteet
model Product {
  id           Int           @id @default(autoincrement())
  name         String
  code         String? // Tuotekoodi
  category     String // Tatuointi / Stand Up
  hours        Int?
  minutes      Int?
  price        Float
  vatIncluded  Boolean       @default(false)
  vatRate      Float // esim. 25.5
  vatHandling  String        @default("Kotimaan verollinen myynti")
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  quantity     Int?          @default(0)
  invoiceLines InvoiceLine[]
}

//Kontaktit
model Contact {
  id           Int       @id @default(autoincrement())
  name         String
  type         String
  customerCode String? // esim. asiakastunnus
  email        String? // üîπ s√§hk√∂postiosoite laskutusta varten
  address      String? // üîπ katuosoite
  zip          String? // üîπ postinumero
  city         String? // üîπ postitoimipaikka
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  invoices     Invoice[]
}

//Keikkamatkat
model Trip {
  id           Int      @id @default(autoincrement())
  date         DateTime
  startAddress String
  endAddress   String
  kilometers   Int
  allowance    String // "full", "half", "none"
  createdAt    DateTime @default(now())
  notes        String?
}

// Lasku
model Invoice {
  id              Int     @id @default(autoincrement())
  invoiceNumber   Int?    @unique // üîπ Ei pakollinen ‚Äì luodaan hyv√§ksynn√§ss√§
  referenceNumber String? // üîπ Luodaan hyv√§ksynn√§ss√§ (viitenumero)
  status          String  @default("DRAFT") // DRAFT / APPROVED

  date        DateTime @default(now())
  dueDate     DateTime
  paymentTerm Int      @default(14)
  notes       String?

  customerId     Int?
  customer       Contact? @relation(fields: [customerId], references: [id])
  customCustomer String?

  netAmount   Float  @default(0)
  vatAmount   Float  @default(0)
  totalAmount Float  @default(0)
  vatRate     Float?

  lines InvoiceLine[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InvoiceCounter {
  id        Int      @id @default(1)
  current   Int      @default(100) // üîπ Alkaa laskunumerosta 101
  updatedAt DateTime @updatedAt
}

model InvoiceLine {
  id        Int     @id @default(autoincrement())
  invoiceId Int
  invoice   Invoice @relation(fields: [invoiceId], references: [id])

  productId Int?
  product   Product? @relation(fields: [productId], references: [id])

  description String
  quantity    Float  @default(1)
  unitPrice   Float  @default(0)
  vatRate     Float  @default(24)

  vatHandling String? // ‚≠ê UUSI
  vatCode     String? // ‚≠ê UUSI

  total Float @default(0)
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String
  type        String
  defaultVat  Float
  description String?
  createdAt   DateTime @default(now())

  entries BookkeepingEntry[]
}
